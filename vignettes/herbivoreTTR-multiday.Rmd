---
title: "Multi-day Simulation and Plots with herbivoreTTR"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Multi-day Simulation and Plots}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```r
#| label: setup
#| include: false
knitr::opts_chunk$set(collapse = TRUE, comment = "#>")
```

Introduction
------------

This vignette runs a short, multi-day simulation and produces a few simple plots summarising
herbivore energy intake/balance and changes in plant biomass over time. It assumes the package
has been installed or loaded via `devtools::load_all()`.

Setup
-----

```r
library(herbivoreTTR)

# Initialise a default scenario
sim <- init_simulation(temp_mode = "flat", veg_types = c(0, 1, 2), herbivore_mass = 5e5)

# Choose a start day immediately after spin-up so herbivory is active
spinup_days <- CONSTANTS$SPIN_UP_LENGTH * nrow(sim$conditions)
day0 <- spinup_days + 1L

# Run a short 7-day sequence at 60-minute resolution for speed
n_days <- 7L
minute_limit <- 60L

herb <- sim$herbivore
plants <- sim$plants
cond <- sim$conditions

# Collect daily metrics into a data.frame
daily <- data.frame(
  day = seq_len(n_days),
  intake_PE_kJ = NA_real_,
  intake_NPE_kJ = NA_real_,
  energy_balance_kJ = NA_real_,
  distance_moved_m = NA_real_,
  intake_total_g = NA_real_,
  plant_ms_total_kg = NA_real_
)

for (k in seq_len(n_days)) {
  res <- run_daily_herbivore_simulation(
    herbivore = herb,
    plants = plants,
    conditions = cond,
    day_of_simulation = day0 + (k - 1L),
    minute_limit = minute_limit
  )
  herb <- res$herbivore
  plants <- res$plants

  daily$intake_PE_kJ[k] <- herb$intake_PE_day
  daily$intake_NPE_kJ[k] <- herb$intake_NPE_day
  daily$energy_balance_kJ[k] <- herb$energy_balance
  daily$distance_moved_m[k] <- herb$distance_moved
  daily$intake_total_g[k] <- herb$intake_total_day
  daily$plant_ms_total_kg[k] <- sum(plants$ms)
}

head(daily)
```

Plots
-----

Energy intake and balance (base R):

```r
op <- par(mfrow = c(1, 2), mar = c(4, 4, 2, 1))

plot(
  daily$day,
  daily$intake_PE_kJ + daily$intake_NPE_kJ,
  type = "b", pch = 19, col = "steelblue",
  xlab = "Day", ylab = "Daily energy intake (kJ)",
  main = "Protein + non-protein energy"
)

plot(
  daily$day,
  daily$energy_balance_kJ,
  type = "b", pch = 19, col = "firebrick",
  xlab = "Day", ylab = "Energy balance (kJ)",
  main = "Cumulative energy balance"
)
par(op)
```

Plant biomass trajectory:

```r
plot(
  daily$day,
  daily$plant_ms_total_kg,
  type = "b", pch = 19, col = "darkgreen",
  xlab = "Day", ylab = "Total shoot mass (kg)",
  main = "Plant shoot mass over time"
)
```

End-of-run plant status (optional):

```r
op <- par(mfrow = c(1, 2), mar = c(4, 4, 2, 1))
hist(plants$ms, breaks = 20, col = "gray70", border = "white",
     xlab = "Shoot mass (kg)", main = "Final-day shoot mass")
plot(plants$xcor, plants$ycor, pch = 16, cex = pmax(plants$ms, 1e-3) / max(plants$ms),
     col = rgb(0, 0.5, 0, 0.5), xlab = "x (m)", ylab = "y (m)",
     main = "Spatial distribution (size ~ Ms)")
par(op)
```

Notes
-----

- To explore defence transport/growth, set `CONSTANTS$DEFENCE_ENABLED <- 1` before running and
  re-run the simulation.
- Increase `minute_limit` (up to 1440) for more detailed intra-day dynamics.
- Results will vary with different `veg_types`, herbivore mass, and environmental settings.

