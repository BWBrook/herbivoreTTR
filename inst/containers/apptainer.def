BootStrap: docker
From: rocker/r2u:jammy

%post
    # Install system dependencies for geospatial work
    apt-get update && apt-get install -y --no-install-recommends \
        gdal-bin libgdal-dev libgeos-dev libproj-dev libudunits2-dev \
        && rm -rf /var/lib/apt/lists/*

    # Copy project files into image (handled in %files section)

    # Install renv and restore project packages
    R -q -e "install.packages('renv'); renv::restore(prompt = FALSE)"

%files
    . /project

%environment
    export R_LIBS_USER=/usr/local/lib/R/site-library

%runscript
    exec R -q -e "targets::tar_make()"